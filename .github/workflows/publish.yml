name: Publish to PyPi

on:
    push:
        branches:
        -   master

jobs:
    publish:
        runs-on: ubuntu-latest
        if: ${{ startsWith(github.event.head_commit.message, '[deploy]') }}
        steps:
        -   uses: actions/checkout@v2
        -   name: Set up Python
            uses: actions/setup-python@v2
            with:
                python-version: 3.x
        -   name: Install dependencies
            run: |
                python -m pip install --upgrade pip
                pip install build wheel
        -   name: Build package
            run: python -m build
        -   name: Publish package
            uses: pypa/gh-action-pypi-publish@release/v1
            with:
                user: __token__
                password: ${{ secrets.PYPI_API_TOKEN }}
